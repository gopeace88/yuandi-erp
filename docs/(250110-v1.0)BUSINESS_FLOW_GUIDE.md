# YUANDI ERP ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° & ë°ì´í„° ê²€ì¦ ê°€ì´ë“œ

> ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ í”„ë¡œì„¸ìŠ¤ì˜ ë°ì´í„° íë¦„ê³¼ ê²€ì¦ í¬ì¸íŠ¸ë¥¼ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.
> ê° ì‘ì—… ì‹œ ì–´ë–¤ í…Œì´ë¸”ì˜ ì–´ë–¤ í•„ë“œê°€ ì—…ë°ì´íŠ¸ë˜ê³ , ë¬´ì—‡ì„ í™•ì¸í•´ì•¼ í•˜ëŠ”ì§€ ëª…ì‹œí•©ë‹ˆë‹¤.

## ğŸ“Œ ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ì£¼ìš” ë³€ê²½ì‚¬í•­ |
|------|------|--------|--------------|
| v1.0 | 2025-01-10 | YUANDI ERP Dev Team | - ì´ˆê¸° ë¬¸ì„œ ì‘ì„±<br>- ì „ì²´ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì •ë¦¬<br>- ë°ì´í„° ì—…ë°ì´íŠ¸ í•„ë“œ ëª…ì„¸<br>- ê²€ì¦ í¬ì¸íŠ¸ ë° SQL ì¿¼ë¦¬ ì¶”ê°€<br>- íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ í¬í•¨ |

## ğŸ“‹ ëª©ì°¨
1. [ì¬ê³  ê´€ë¦¬](#1-ì¬ê³ -ê´€ë¦¬)
2. [ì£¼ë¬¸ ê´€ë¦¬](#2-ì£¼ë¬¸-ê´€ë¦¬)
3. [ë°°ì†¡ ê´€ë¦¬](#3-ë°°ì†¡-ê´€ë¦¬)
4. [ì¶œë‚©ì¥ë¶€](#4-ì¶œë‚©ì¥ë¶€)
5. [ëŒ€ì‹œë³´ë“œ](#5-ëŒ€ì‹œë³´ë“œ)

---

## 1. ì¬ê³  ê´€ë¦¬

### 1.1 ìƒí’ˆ ë“±ë¡ (ëª¨ë‹¬: ì‹ ê·œ ìƒí’ˆ ë“±ë¡)

#### ë°ì´í„° í”Œë¡œìš°:
```
ì‚¬ìš©ì ì…ë ¥ â†’ products í…Œì´ë¸” INSERT â†’ inventory_movements ê¸°ë¡ â†’ ì¬ê³  ëª©ë¡ ê°±ì‹ 
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**products í…Œì´ë¸”:**
- `name`: ìƒí’ˆëª… (í•„ìˆ˜)
- `category`: ì¹´í…Œê³ ë¦¬ (í•„ìˆ˜)
- `model`: ëª¨ë¸ëª… (í•„ìˆ˜)
- `color`: ìƒ‰ìƒ (ì„ íƒ)
- `brand`: ë¸Œëœë“œ (ì„ íƒ)
- `sku`: ìë™ ìƒì„± ([Category]-[Model]-[Color]-[Brand]-[HASH5])
- `cost_cny`: ì›ê°€ (í•„ìˆ˜)
- `price_krw`: íŒë§¤ê°€ (í•„ìˆ˜)
- `on_hand`: ì´ˆê¸° ì¬ê³  ìˆ˜ëŸ‰ (í•„ìˆ˜, ê¸°ë³¸ê°’ 1)
- `low_stock_threshold`: ì¬ê³  ë¶€ì¡± ì„ê³„ê°’ (ê¸°ë³¸ê°’ 5)
- `is_active`: true (ê¸°ë³¸ê°’)
- `created_at`: í˜„ì¬ ì‹œê°„
- `updated_at`: í˜„ì¬ ì‹œê°„

**inventory_movements í…Œì´ë¸”:**
- `product_id`: ìƒì„±ëœ ìƒí’ˆ ID
- `movement_type`: 'inbound'
- `quantity`: ì´ˆê¸° ì¬ê³  ìˆ˜ëŸ‰
- `balance_before`: 0
- `balance_after`: ì´ˆê¸° ì¬ê³  ìˆ˜ëŸ‰
- `note`: 'ì´ˆê¸° ì¬ê³ '
- `movement_date`: í˜„ì¬ ì‹œê°„
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **í•„ìˆ˜ í•„ë“œ í™•ì¸**: name, category, model, cost_cny, price_krw
2. **SKU ì¤‘ë³µ í™•ì¸**: ìƒì„±ëœ SKUê°€ ê¸°ì¡´ ìƒí’ˆê³¼ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”ì§€
3. **ê°€ê²© ìœ íš¨ì„±**: cost_cny > 0, price_krw > 0
4. **ì¬ê³  ìˆ˜ëŸ‰**: on_hand >= 0

#### í™•ì¸ ë°©ë²•:
```sql
-- ìƒí’ˆ ìƒì„± í™•ì¸
SELECT * FROM products WHERE id = 'ìƒì„±ëœ_ìƒí’ˆ_ID';

-- ì¬ê³  ì´ë™ ë‚´ì—­ í™•ì¸
SELECT * FROM inventory_movements 
WHERE product_id = 'ìƒì„±ëœ_ìƒí’ˆ_ID' 
ORDER BY created_at DESC;
```

---

### 1.2 ì¬ê³  ì…ê³  (ëª¨ë‹¬: ì¬ê³  ì…ê³ )

#### ë°ì´í„° í”Œë¡œìš°:
```
ì…ê³  ì •ë³´ ì…ë ¥ â†’ products.on_hand ì¦ê°€ â†’ inventory_movements ê¸°ë¡ â†’ cashbook_transactions ê¸°ë¡ â†’ ì¬ê³  ëª©ë¡ ê°±ì‹ 
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**products í…Œì´ë¸”:**
- `on_hand`: ê¸°ì¡´ê°’ + ì…ê³ ìˆ˜ëŸ‰
- `updated_at`: í˜„ì¬ ì‹œê°„

**inventory_movements í…Œì´ë¸”:**
- `product_id`: ëŒ€ìƒ ìƒí’ˆ ID
- `movement_type`: 'inbound'
- `quantity`: ì…ê³  ìˆ˜ëŸ‰ (ì–‘ìˆ˜)
- `balance_before`: ì…ê³  ì „ ì¬ê³ 
- `balance_after`: ì…ê³  í›„ ì¬ê³ 
- `unit_cost`: ë‹¨ê°€ (ì„ íƒ)
- `total_cost`: ë‹¨ê°€ Ã— ìˆ˜ëŸ‰
- `note`: ì…ê³  ë©”ëª¨
- `movement_date`: í˜„ì¬ ì‹œê°„
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

**cashbook_transactions í…Œì´ë¸”:**
- `transaction_date`: í˜„ì¬ ë‚ ì§œ
- `type`: 'inbound'
- `amount`: ì´ ë¹„ìš© (ë‹¨ê°€ Ã— ìˆ˜ëŸ‰)
- `amount_krw`: ì´ ë¹„ìš©
- `currency`: 'KRW'
- `description`: '[ìƒí’ˆëª…] ì¬ê³  ì…ê³  (ìˆ˜ëŸ‰ê°œ)'
- `ref_type`: 'inventory_movement'
- `ref_id`: movement ID
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **ì¬ê³  ì¦ê°€ í™•ì¸**: products.on_handê°€ ì •í™•íˆ ì¦ê°€í–ˆëŠ”ì§€
2. **ì”ëŸ‰ ê³„ì‚°**: balance_after = balance_before + quantity
3. **ì¶œë‚©ì¥ë¶€ ê¸°ë¡**: ì§€ì¶œ ê¸ˆì•¡ì´ ì •í™•íˆ ê¸°ë¡ë˜ì—ˆëŠ”ì§€

#### í™•ì¸ ë°©ë²•:
```sql
-- ì¬ê³  í™•ì¸
SELECT on_hand FROM products WHERE id = 'ìƒí’ˆ_ID';

-- ì¬ê³  ì´ë™ ë‚´ì—­
SELECT * FROM inventory_movements 
WHERE product_id = 'ìƒí’ˆ_ID' 
ORDER BY created_at DESC LIMIT 1;

-- ì¶œë‚©ì¥ë¶€ í™•ì¸
SELECT * FROM cashbook_transactions 
WHERE ref_type = 'inventory_movement' 
AND ref_id = 'movement_ID';
```

---

### 1.3 ì¬ê³  ì¡°ì • (ë²„íŠ¼: ì¬ê³  ì¡°ì •)

#### ë°ì´í„° í”Œë¡œìš°:
```
ì¡°ì • ìˆ˜ëŸ‰ ì…ë ¥ â†’ products.on_hand ì¡°ì • â†’ inventory_movements ê¸°ë¡ â†’ ì¬ê³  ëª©ë¡ ê°±ì‹ 
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**products í…Œì´ë¸”:**
- `on_hand`: ê¸°ì¡´ê°’ + ì¡°ì •ìˆ˜ëŸ‰ (ìŒìˆ˜ ê°€ëŠ¥)
- `updated_at`: í˜„ì¬ ì‹œê°„

**inventory_movements í…Œì´ë¸”:**
- `product_id`: ëŒ€ìƒ ìƒí’ˆ ID
- `movement_type`: 'adjustment'
- `quantity`: ì¡°ì • ìˆ˜ëŸ‰ (ì–‘ìˆ˜/ìŒìˆ˜)
- `balance_before`: ì¡°ì • ì „ ì¬ê³ 
- `balance_after`: ì¡°ì • í›„ ì¬ê³ 
- `note`: ì¡°ì • ì‚¬ìœ 
- `movement_date`: í˜„ì¬ ì‹œê°„
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **ì¬ê³  ìŒìˆ˜ ë°©ì§€**: balance_after >= 0
2. **ì¡°ì • ì‚¬ìœ  í•„ìˆ˜**: note í•„ë“œ í•„ìˆ˜ ì…ë ¥

---

## 2. ì£¼ë¬¸ ê´€ë¦¬

### 2.1 ì£¼ë¬¸ ìƒì„± (í˜ì´ì§€: ì£¼ë¬¸ ê´€ë¦¬ â†’ ì‹ ê·œ ì£¼ë¬¸)

#### ë°ì´í„° í”Œë¡œìš°:
```
ì£¼ë¬¸ ì •ë³´ ì…ë ¥ â†’ orders í…Œì´ë¸” INSERT â†’ order_items INSERT â†’ 
products.on_hand ê°ì†Œ â†’ inventory_movements ê¸°ë¡ â†’ 
cashbook_transactions ê¸°ë¡ (ìˆ˜ì…) â†’ event_logs ê¸°ë¡ â†’ ëŒ€ì‹œë³´ë“œ ê°±ì‹ 
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**orders í…Œì´ë¸”:**
- `order_number`: 'ORD-YYMMDD-###' (ì¼ë³„ ìˆœë²ˆ)
- `customer_name`: ê³ ê°ëª…
- `customer_phone`: ì „í™”ë²ˆí˜¸
- `customer_messenger_id`: ë©”ì‹ ì € ID (ì„ íƒ)
- `status`: 'paid' (ê¸°ë³¸ê°’)
- `total_krw`: ì´ ê¸ˆì•¡
- `shipping_address_line1`: ì£¼ì†Œ
- `shipping_address_line2`: ìƒì„¸ì£¼ì†Œ
- `shipping_postal_code`: ìš°í¸ë²ˆí˜¸
- `payment_method`: ê²°ì œ ë°©ë²•
- `notes`: ì£¼ë¬¸ ë©”ëª¨
- `created_at`: í˜„ì¬ ì‹œê°„
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

**order_items í…Œì´ë¸”:**
- `order_id`: ìƒì„±ëœ ì£¼ë¬¸ ID
- `product_id`: ìƒí’ˆ ID
- `sku`: ìƒí’ˆ SKU (ë¹„ì •ê·œí™”)
- `product_name`: ìƒí’ˆëª… (ë¹„ì •ê·œí™”)
- `product_category`: ì¹´í…Œê³ ë¦¬ (ë¹„ì •ê·œí™”)
- `product_model`: ëª¨ë¸ (ë¹„ì •ê·œí™”)
- `product_color`: ìƒ‰ìƒ (ë¹„ì •ê·œí™”)
- `product_brand`: ë¸Œëœë“œ (ë¹„ì •ê·œí™”)
- `quantity`: ì£¼ë¬¸ ìˆ˜ëŸ‰
- `unit_price_krw`: ë‹¨ê°€
- `total_price_krw`: ë‹¨ê°€ Ã— ìˆ˜ëŸ‰

**products í…Œì´ë¸”:**
- `on_hand`: ê¸°ì¡´ê°’ - ì£¼ë¬¸ìˆ˜ëŸ‰

**inventory_movements í…Œì´ë¸”:**
- `product_id`: ìƒí’ˆ ID
- `movement_type`: 'sale'
- `quantity`: -ì£¼ë¬¸ìˆ˜ëŸ‰ (ìŒìˆ˜)
- `balance_before`: íŒë§¤ ì „ ì¬ê³ 
- `balance_after`: íŒë§¤ í›„ ì¬ê³ 
- `note`: 'ì£¼ë¬¸ #ì£¼ë¬¸ë²ˆí˜¸'
- `movement_date`: í˜„ì¬ ì‹œê°„
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

**cashbook_transactions í…Œì´ë¸”:**
- `transaction_date`: í˜„ì¬ ë‚ ì§œ
- `type`: 'sale'
- `amount`: ì£¼ë¬¸ ì´ì•¡
- `amount_krw`: ì£¼ë¬¸ ì´ì•¡
- `currency`: 'KRW'
- `description`: 'ì£¼ë¬¸ íŒë§¤ ìˆ˜ìµ - ì£¼ë¬¸ë²ˆí˜¸ (ê³ ê°ëª…)'
- `reference_type`: 'order'
- `reference_id`: ì£¼ë¬¸ ID
- `created_by`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

**event_logs í…Œì´ë¸”:**
- `entity_type`: 'order'
- `entity_id`: ì£¼ë¬¸ ID
- `action`: 'created'
- `details`: ì£¼ë¬¸ ìƒì„¸ ì •ë³´ JSON
- `user_id`: ë¡œê·¸ì¸ ì‚¬ìš©ì ID

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **ì¬ê³  í™•ì¸**: products.on_hand >= ì£¼ë¬¸ìˆ˜ëŸ‰
2. **ì£¼ë¬¸ë²ˆí˜¸ ì¤‘ë³µ**: ê°™ì€ ë‚ ì§œì— ë™ì¼ ë²ˆí˜¸ ì—†ìŒ
3. **ì¬ê³  ê°ì†Œ**: products.on_handê°€ ì •í™•íˆ ê°ì†Œ
4. **ê¸ˆì•¡ ê³„ì‚°**: total_krw = Î£(unit_price_krw Ã— quantity)
5. **ì¶œë‚©ì¥ë¶€ ì”ì•¡**: ì´ì „ ì”ì•¡ + ì£¼ë¬¸ ê¸ˆì•¡

#### í™•ì¸ ë°©ë²•:
```sql
-- ì£¼ë¬¸ í™•ì¸
SELECT * FROM orders WHERE id = 'ì£¼ë¬¸_ID';

-- ì£¼ë¬¸ ì•„ì´í…œ í™•ì¸
SELECT * FROM order_items WHERE order_id = 'ì£¼ë¬¸_ID';

-- ì¬ê³  ê°ì†Œ í™•ì¸
SELECT on_hand FROM products WHERE id = 'ìƒí’ˆ_ID';

-- ì¬ê³  ì´ë™ ë‚´ì—­
SELECT * FROM inventory_movements 
WHERE note LIKE '%ì£¼ë¬¸ë²ˆí˜¸%';

-- ì¶œë‚©ì¥ë¶€ í™•ì¸
SELECT * FROM cashbook_transactions 
WHERE reference_type = 'order' AND reference_id = 'ì£¼ë¬¸_ID';
```

---

### 2.2 ì£¼ë¬¸ ìƒíƒœ ë³€ê²½

#### 2.2.1 ë°°ì†¡ ì¤‘ (paid â†’ shipped)

#### ë°ì´í„° í”Œë¡œìš°:
```
ìƒíƒœ ë³€ê²½ â†’ orders.status = 'shipped' â†’ orders.shipped_at ê¸°ë¡ â†’ 
shipments í…Œì´ë¸” ìƒì„±/ì—…ë°ì´íŠ¸ â†’ event_logs ê¸°ë¡
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**orders í…Œì´ë¸”:**
- `status`: 'shipped'
- `shipped_at`: í˜„ì¬ ì‹œê°„
- `updated_at`: í˜„ì¬ ì‹œê°„

**shipments í…Œì´ë¸”:**
- `order_id`: ì£¼ë¬¸ ID
- `tracking_number_kr`: í•œêµ­ ìš´ì†¡ì¥ ë²ˆí˜¸
- `tracking_number_cn`: ì¤‘êµ­ ìš´ì†¡ì¥ ë²ˆí˜¸
- `carrier_kr`: í•œêµ­ íƒë°°ì‚¬
- `carrier_cn`: ì¤‘êµ­ íƒë°°ì‚¬
- `status`: 'in_transit'
- `shipped_date`: í˜„ì¬ ë‚ ì§œ
- `created_at`: í˜„ì¬ ì‹œê°„

**event_logs í…Œì´ë¸”:**
- `entity_type`: 'order'
- `entity_id`: ì£¼ë¬¸ ID
- `action`: 'shipped'
- `details`: ë°°ì†¡ ì •ë³´ JSON

---

#### 2.2.2 ë°°ì†¡ ì™„ë£Œ (shipped â†’ done)

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**orders í…Œì´ë¸”:**
- `status`: 'done'
- `delivered_at`: í˜„ì¬ ì‹œê°„

**shipments í…Œì´ë¸”:**
- `status`: 'delivered'
- `delivered_date`: í˜„ì¬ ë‚ ì§œ

---

#### 2.2.3 í™˜ë¶ˆ (any â†’ refunded)

#### ë°ì´í„° í”Œë¡œìš°:
```
í™˜ë¶ˆ ì²˜ë¦¬ â†’ orders.status = 'refunded' â†’ products.on_hand ë³µêµ¬ â†’ 
inventory_movements ê¸°ë¡ â†’ cashbook_transactions ê¸°ë¡ (ì§€ì¶œ) â†’ 
inventory.allocated ê°ì†Œ â†’ event_logs ê¸°ë¡
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**orders í…Œì´ë¸”:**
- `status`: 'refunded'
- `updated_at`: í˜„ì¬ ì‹œê°„

**products í…Œì´ë¸”:**
- `on_hand`: ê¸°ì¡´ê°’ + í™˜ë¶ˆìˆ˜ëŸ‰ (ì¬ê³  ë³µêµ¬)

**inventory í…Œì´ë¸”:**
- `allocated`: ê¸°ì¡´ê°’ - í™˜ë¶ˆìˆ˜ëŸ‰

**inventory_movements í…Œì´ë¸”:**
- `product_id`: ìƒí’ˆ ID
- `movement_type`: 'adjustment'
- `quantity`: +í™˜ë¶ˆìˆ˜ëŸ‰ (ì–‘ìˆ˜, ì¬ê³  ì¦ê°€)
- `balance_before`: ë³µêµ¬ ì „ ì¬ê³ 
- `balance_after`: ë³µêµ¬ í›„ ì¬ê³ 
- `note`: 'ì£¼ë¬¸ í™˜ë¶ˆ #ì£¼ë¬¸ID'

**cashbook_transactions í…Œì´ë¸”:**
- `type`: 'refund'
- `amount`: -í™˜ë¶ˆê¸ˆì•¡ (ì§€ì¶œ)
- `description`: 'ì£¼ë¬¸ í™˜ë¶ˆ - ì£¼ë¬¸ë²ˆí˜¸ (ê³ ê°ëª…)'

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **ì¬ê³  ë³µêµ¬**: products.on_hand ì¦ê°€ í™•ì¸
2. **ì¶œë‚©ì¥ë¶€**: í™˜ë¶ˆ ê¸ˆì•¡ì´ ì§€ì¶œë¡œ ê¸°ë¡
3. **í• ë‹¹ëŸ‰ ê°ì†Œ**: inventory.allocated ê°ì†Œ

---

## 3. ë°°ì†¡ ê´€ë¦¬

### 3.1 ë°°ì†¡ ì •ë³´ ë“±ë¡/ìˆ˜ì •

#### ë°ì´í„° í”Œë¡œìš°:
```
ìš´ì†¡ì¥ ë²ˆí˜¸ ì…ë ¥ â†’ shipments í…Œì´ë¸” INSERT/UPDATE â†’ orders.status ì—…ë°ì´íŠ¸ â†’ event_logs ê¸°ë¡
```

#### ì—…ë°ì´íŠ¸ í•„ë“œ:
**shipments í…Œì´ë¸”:**
- `tracking_number_kr`: í•œêµ­ ìš´ì†¡ì¥ ë²ˆí˜¸
- `tracking_number_cn`: ì¤‘êµ­ ìš´ì†¡ì¥ ë²ˆí˜¸
- `carrier_kr`: í•œêµ­ íƒë°°ì‚¬
- `carrier_cn`: ì¤‘êµ­ íƒë°°ì‚¬
- `status`: 'pending'/'in_transit'/'delivered'
- `shipped_date`: ë°œì†¡ì¼
- `delivered_date`: ë°°ì†¡ì™„ë£Œì¼
- `notes`: ë°°ì†¡ ë©”ëª¨

---

## 4. ì¶œë‚©ì¥ë¶€

### 4.1 ê±°ë˜ ë‚´ì—­ ìë™ ê¸°ë¡

#### ìë™ ê¸°ë¡ ì‹œì :
1. **ìˆ˜ì… (+)**
   - ì£¼ë¬¸ ìƒì„± ì‹œ (type: 'sale')
   - ê¸°íƒ€ ìˆ˜ì… ë“±ë¡ ì‹œ (type: 'other_income')

2. **ì§€ì¶œ (-)**
   - ì¬ê³  ì…ê³  ì‹œ (type: 'inbound')
   - ì£¼ë¬¸ í™˜ë¶ˆ ì‹œ (type: 'refund')
   - ê¸°íƒ€ ì§€ì¶œ ë“±ë¡ ì‹œ (type: 'other_expense')

#### í•„ìˆ˜ í•„ë“œ:
**cashbook_transactions í…Œì´ë¸”:**
- `transaction_date`: ê±°ë˜ ë‚ ì§œ
- `type`: ê±°ë˜ ìœ í˜•
- `amount`: ê¸ˆì•¡ (ì›í™”)
- `amount_krw`: ì›í™” í™˜ì‚° ê¸ˆì•¡
- `currency`: í†µí™” (KRW/CNY/USD)
- `fx_rate`: í™˜ìœ¨ (ê¸°ë³¸ 1.0)
- `balance_krw`: í˜„ì¬ ì”ì•¡ (ì´ì „ ì”ì•¡ + ê¸ˆì•¡)
- `description`: ê±°ë˜ ì„¤ëª…
- `reference_type`: ì°¸ì¡° ìœ í˜• (order/inventory_movement)
- `reference_id`: ì°¸ì¡° ID
- `created_by`: ì‘ì„±ì

#### ê²€ì¦ í¬ì¸íŠ¸:
1. **ì”ì•¡ ì—°ì†ì„±**: ê° ê±°ë˜ì˜ balance_krw = ì´ì „ balance_krw + amount_krw
2. **ì°¸ì¡° ë¬´ê²°ì„±**: reference_idê°€ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë ˆì½”ë“œ
3. **í™˜ìœ¨ ì ìš©**: CNY/USD ê±°ë˜ ì‹œ fx_rate ì ìš© í™•ì¸

---

## 5. ëŒ€ì‹œë³´ë“œ

### 5.1 ì‹¤ì‹œê°„ í†µê³„ ê°±ì‹ 

#### ê°±ì‹  íŠ¸ë¦¬ê±°:
- ì£¼ë¬¸ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- ì¬ê³  ì…ê³ /ì¡°ì •
- ë°°ì†¡ ìƒíƒœ ë³€ê²½

#### í‘œì‹œ ë°ì´í„°:
**ì˜¤ëŠ˜ í†µê³„:**
- ì˜¤ëŠ˜ ì£¼ë¬¸ ìˆ˜: `COUNT(*) WHERE DATE(created_at) = TODAY AND status != 'cancelled'`
- ì˜¤ëŠ˜ ë§¤ì¶œ: `SUM(total_krw) WHERE DATE(created_at) = TODAY AND status != 'cancelled'`

**ì´ë²ˆ ë‹¬ í†µê³„:**
- ì›” ì£¼ë¬¸ ìˆ˜: `COUNT(*) WHERE MONTH(created_at) = THIS_MONTH`
- ì›” ë§¤ì¶œ: `SUM(total_krw) WHERE MONTH(created_at) = THIS_MONTH`

**ì¬ê³  í†µê³„:**
- ì´ ìƒí’ˆ ìˆ˜: `COUNT(*) FROM products WHERE is_active = true`
- ì¬ê³  ë¶€ì¡±: `COUNT(*) WHERE on_hand <= low_stock_threshold`

**ë°°ì†¡ í†µê³„:**
- ë°°ì†¡ ëŒ€ê¸°: `COUNT(*) WHERE status = 'paid'`
- ë°°ì†¡ ì¤‘: `COUNT(*) WHERE status = 'shipped'`

---

## 6. ì‹œìŠ¤í…œ ë¡œê·¸ & ê°ì‚¬

### 6.1 Event Logs

ëª¨ë“  ì¤‘ìš” ì‘ì—…ì€ event_logs í…Œì´ë¸”ì— ê¸°ë¡:

#### ê¸°ë¡ ëŒ€ìƒ:
- ì£¼ë¬¸ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- ì¬ê³  ì…ê³ /ì¡°ì •
- ìƒí’ˆ ë“±ë¡/ìˆ˜ì •
- ì‚¬ìš©ì ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
- ê¶Œí•œ ë³€ê²½

#### í•„ë“œ:
- `entity_type`: ì—”í‹°í‹° ìœ í˜• (order/product/user)
- `entity_id`: ì—”í‹°í‹° ID
- `action`: ì‘ì—… (created/updated/deleted)
- `details`: ìƒì„¸ ì •ë³´ JSON
- `user_id`: ì‘ì—… ì‚¬ìš©ì
- `created_at`: ì‘ì—… ì‹œê°„

---

## 7. ë°ì´í„° ì •í•©ì„± ê²€ì¦ SQL

### ì¼ì¼ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸:

```sql
-- 1. ì¬ê³  ì´ë™ ë‚´ì—­ê³¼ ì‹¤ì œ ì¬ê³  ì¼ì¹˜ í™•ì¸
SELECT 
  p.id,
  p.name,
  p.on_hand as current_stock,
  COALESCE(
    (SELECT balance_after 
     FROM inventory_movements 
     WHERE product_id = p.id 
     ORDER BY created_at DESC 
     LIMIT 1), 0
  ) as last_balance
FROM products p
WHERE p.on_hand != COALESCE(
  (SELECT balance_after 
   FROM inventory_movements 
   WHERE product_id = p.id 
   ORDER BY created_at DESC 
   LIMIT 1), 0
);

-- 2. ì¶œë‚©ì¥ë¶€ ì”ì•¡ ì—°ì†ì„± í™•ì¸
SELECT 
  t1.id,
  t1.transaction_date,
  t1.balance_krw as current_balance,
  t2.balance_krw + t1.amount_krw as calculated_balance
FROM cashbook_transactions t1
LEFT JOIN cashbook_transactions t2 ON t2.id = (
  SELECT id FROM cashbook_transactions 
  WHERE created_at < t1.created_at 
  ORDER BY created_at DESC 
  LIMIT 1
)
WHERE t1.balance_krw != (t2.balance_krw + t1.amount_krw);

-- 3. ì£¼ë¬¸ ì´ì•¡ê³¼ ì•„ì´í…œ í•©ê³„ ì¼ì¹˜ í™•ì¸
SELECT 
  o.id,
  o.order_number,
  o.total_krw as order_total,
  SUM(oi.total_price_krw) as items_total
FROM orders o
JOIN order_items oi ON oi.order_id = o.id
GROUP BY o.id, o.order_number, o.total_krw
HAVING o.total_krw != SUM(oi.total_price_krw);

-- 4. ì¬ê³  ë¶€ì¡± ìƒí’ˆ í™•ì¸
SELECT 
  id,
  name,
  on_hand,
  low_stock_threshold
FROM products
WHERE on_hand <= low_stock_threshold
AND is_active = true;
```

---

## 8. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ë¬¸ì œ: ì¬ê³ ê°€ ìŒìˆ˜ê°€ ë¨
**ì›ì¸**: ì£¼ë¬¸ ì‹œ ì¬ê³  í™•ì¸ ëˆ„ë½
**í•´ê²°**: 
1. products.on_handë¥¼ 0 ì´ìƒìœ¼ë¡œ ì¡°ì •
2. inventory_movementsì— ì¡°ì • ê¸°ë¡ ì¶”ê°€
3. ì£¼ë¬¸ ìƒì„± ì‹œ ì¬ê³  í™•ì¸ ë¡œì§ ì¶”ê°€

### ë¬¸ì œ: ì¶œë‚©ì¥ë¶€ ì”ì•¡ ë¶ˆì¼ì¹˜
**ì›ì¸**: ë™ì‹œ ê±°ë˜ ì²˜ë¦¬ ì‹œ ì”ì•¡ ê³„ì‚° ì˜¤ë¥˜
**í•´ê²°**:
1. íŠ¸ëœì­ì…˜ ì‚¬ìš©í•˜ì—¬ ìˆœì°¨ ì²˜ë¦¬
2. ì”ì•¡ ì¬ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
3. cashbook_transactions í…Œì´ë¸” ë½ ì‚¬ìš©

### ë¬¸ì œ: ì£¼ë¬¸ë²ˆí˜¸ ì¤‘ë³µ
**ì›ì¸**: ë™ì‹œ ì£¼ë¬¸ ìƒì„±
**í•´ê²°**:
1. ì£¼ë¬¸ë²ˆí˜¸ ìƒì„± ì‹œ íŠ¸ëœì­ì…˜ ì‚¬ìš©
2. UNIQUE ì œì•½ì¡°ê±´ ì¶”ê°€
3. ì¬ì‹œë„ ë¡œì§ êµ¬í˜„

---

## 9. ì„±ëŠ¥ ìµœì í™” í¬ì¸íŠ¸

### ì¸ë±ìŠ¤ í•„ìˆ˜ ì»¬ëŸ¼:
- orders.order_number
- orders.status
- orders.created_at
- products.sku
- inventory_movements.product_id
- inventory_movements.created_at
- cashbook_transactions.created_at
- shipments.order_id

### ë¹„ì •ê·œí™” ê¶Œì¥:
- order_itemsì— ìƒí’ˆ ì •ë³´ ë³µì‚¬ (ì´ë¯¸ êµ¬í˜„ë¨)
- ëŒ€ì‹œë³´ë“œìš© ì§‘ê³„ í…Œì´ë¸” ìƒì„± ê³ ë ¤

---

## 10. ë³´ì•ˆ ì²´í¬í¬ì¸íŠ¸

### ê¶Œí•œ ê²€ì¦:
- **admin**: ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥
- **order_manager**: ì£¼ë¬¸/ì¬ê³  ê´€ë¦¬
- **ship_manager**: ë°°ì†¡ ê´€ë¦¬ë§Œ

### ë¯¼ê° ì •ë³´:
- ê³ ê° ì „í™”ë²ˆí˜¸: ë§ˆìŠ¤í‚¹ ì²˜ë¦¬
- ê¸ˆì•¡ ì •ë³´: ê¶Œí•œë³„ í‘œì‹œ
- ë¡œê·¸ì¸ ì •ë³´: ì•”í˜¸í™” ì €ì¥

