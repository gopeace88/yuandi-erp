# (250907-v1.0)SETUP_GUIDE.md — 초기 환경 구축 가이드

## 버전 히스토리

| 버전 | 날짜 | 작성자 | 변경사항 |
|------|------|--------|----------|
| v1.0 | 2025-09-07 | 개발팀 | 최초 작성, Supabase 설정 및 초기화 가이드 |

---

## 📋 사전 요구사항

- Node.js 20.x 이상
- pnpm 패키지 매니저 (`npm install -g pnpm`)
- Supabase 계정 (https://supabase.com)
- Vercel 계정 (선택사항, 배포시)

## 🚀 빠른 시작

### 1. 프로젝트 클론 및 의존성 설치

```bash
# 프로젝트 클론
git clone https://github.com/your-username/yuandi-erp.git
cd yuandi-erp

# 의존성 설치
pnpm install
```

### 2. Supabase 프로젝트 생성

1. [Supabase Dashboard](https://app.supabase.com) 접속
2. "New project" 클릭
3. 프로젝트 정보 입력:
   - Project name: `yuandi-erp`
   - Database Password: 안전한 비밀번호 설정
   - Region: Seoul (ap-northeast-2) 선택

### 3. 데이터베이스 초기화

**⚠️ 주의: 이 작업은 모든 데이터를 삭제합니다!**

#### 3.1 시스템 초기화 프로세스

**1단계: 스키마 초기화**
```bash
# Supabase Dashboard SQL Editor에서 실행
# 또는 psql 등의 도구로 직접 실행
psql $DATABASE_URL -f scripts/01.working_schema_reset.sql
```

이 스크립트는 다음을 수행합니다:
- 모든 테이블 및 타입 재생성
- 기본 데이터 삽입 (카테고리, 출납유형, 환율, 시스템 설정)
- 트리거 및 함수 생성

**참조**: 자세한 내용은 [PRD.md Section 12.1](../docs/(250907-v2.0)PRD.md#121-시스템-초기화-프로세스-)를 참조하세요.

#### 3.2 관리자 계정 생성

**2단계: 관리자 계정 생성**
1. **Supabase Dashboard에서 사용자 생성**:
   - Authentication > Users > "Invite user" 클릭
   - Email: `admin@yuandi.com`
   - Password: `yuandi123!`
   - "Auto Confirm User" 체크
   - "Send invitation email" 체크 해제

2. **프로필 생성 확인**:
```bash
# 스크립트를 통해 user_profiles에 관리자 프로필 생성
psql $DATABASE_URL -f scripts/02.create_admin_helper.sql
```

이 스크립트는:
- auth.users에서 admin@yuandi.com 계정 확인
- user_profiles에 프로필 자동 생성
- 시스템 준비 상태 확인

**사용자 역할 정의**:
| DB 값 | 한국어 표시 | 중국어 표시 | 권한 |
|-------|------------|------------|------|
| `admin` | 시스템 관리자 | 系统管理员 | 전체 기능 접근 |
| `order_manager` | 주문 관리자 | 订单管理员 | 주문/재고 관리 |
| `ship_manager` | 배송 관리자 | 配送管理员 | 배송 관리 |

**주의**: 
- 기본 데이터(카테고리, 출납유형, 환율 등)는 01.working_schema_reset.sql에 포함되어 있습니다.
- 시스템 필수 설정값들이 자동으로 생성됩니다.

```sql
-- categories 테이블 생성 (없는 경우)
CREATE TABLE IF NOT EXISTS categories (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  name_ko VARCHAR(100) NOT NULL,
  name_zh VARCHAR(100) NOT NULL,
  description TEXT,
  is_system BOOLEAN DEFAULT false,
  display_order INTEGER DEFAULT 999,
  active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES user_profiles(id) ON DELETE SET NULL
);

-- 기본 카테고리 삽입 (브랜드별)
INSERT INTO categories (code, name_ko, name_zh, is_system, display_order) VALUES
  ('louis_vuitton', 'Louis Vuitton', '路易威登', true, 1),
  ('gucci', 'Gucci', '古驰', true, 2),
  ('chanel', 'Chanel', '香奈儿', true, 3),
  ('hermes', 'Hermes', '爱马仕', true, 4),
  ('burberry', 'Burberry', '博柏利', true, 5),
  ('prada', 'Prada', '普拉达', true, 6),
  ('dior', 'Dior', '迪奥', true, 7),
  ('balenciaga', 'Balenciaga', '巴黎世家', true, 8),
  ('other', '기타', '其他', true, 999)
ON CONFLICT (code) DO NOTHING;
```

**카테고리 설명**:
- **Louis Vuitton (路易威登)**: 프랑스 명품 브랜드
- **Gucci (古驰)**: 이탈리아 명품 브랜드
- **Chanel (香奈儿)**: 프랑스 명품 브랜드
- **Hermes (爱马仕)**: 프랑스 명품 브랜드
- **Burberry (博柏利)**: 영국 명품 브랜드
- **Prada (普拉达)**: 이탈리아 명품 브랜드
- **Dior (迪奥)**: 프랑스 명품 브랜드
- **Balenciaga (巴黎世家)**: 스페인/프랑스 명품 브랜드
- **기타 (其他)**: 기타 브랜드 및 상품

### 4. 환경 변수 설정

```bash
# .env.local 파일 생성
cp .env.example .env.local
```

`.env.local` 파일 편집:
```env
# Supabase 설정 (Dashboard > Settings > API에서 확인)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_API_KEY=your-anon-key
SUPABASE_API_KEY=your-service-role-key

# 앱 설정
APP_URL=http://localhost:8081
NEXT_PUBLIC_APP_URL=http://localhost:8081

# 배포시 Vercel에서 자동 설정
NEXT_PUBLIC_VERCEL_URL=
```

### 5. Storage 버킷 생성

Supabase Dashboard > Storage:
1. "New bucket" 클릭
2. 버킷 생성:
   - Name: `product-images` (상품 이미지)
   - Public: Yes
   - Name: `shipment-photos` (송장 사진)
   - Public: Yes

### 6. Realtime 설정

Supabase Dashboard > Database > Replication:
1. 다음 테이블 활성화:
   - `orders` (주문 실시간 업데이트)
   - `inventory_logs` (재고 변동 실시간)
   - `cashbook_transactions` (출납장부 실시간)

### 7. 개발 서버 실행

```bash
# 개발 서버 시작
pnpm dev

# http://localhost:8081 접속
# 로그인: admin@yuandi.com / yuandi123!
```

## 🔧 추가 설정

### Edge Functions (선택사항)

```bash
# Supabase CLI 설치
npm install -g supabase

# Edge Functions 배포
supabase functions deploy
```

### Cron Jobs 설정 (선택사항)

Vercel에서 자동 작업 설정:
- 일일 리포트 생성
- 재고 알림
- 백업 작업

## ⚠️ 문제 해결

### 로그인 실패 (Invalid login credentials)

1. auth.users 테이블에 사용자 존재 확인
2. user_profiles 테이블에 동일한 ID로 프로필 존재 확인
3. 비밀번호 재설정: Dashboard > Authentication > Users > Reset password

### 포트 충돌

```bash
# 다른 포트 사용
PORT=3001 pnpm dev
```

### 데이터베이스 연결 실패

1. Supabase 프로젝트 상태 확인 (일시정지되지 않았는지)
2. 환경 변수 확인
3. 네트워크 연결 확인

## 📚 참고 문서

- [PRD.md](./docs/PRD.md) - 제품 요구사항 문서
- [DATABASE_ERD.md](./docs/DATABASE_ERD.md) - 데이터베이스 스키마
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - 배포 가이드
- [MAINTENANCE_GUIDE.md](./MAINTENANCE_GUIDE.md) - 유지보수 가이드