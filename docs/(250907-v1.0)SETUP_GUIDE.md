# (250907-v1.0)SETUP_GUIDE.md — 초기 환경 구축 가이드

## 버전 히스토리

| 버전 | 날짜 | 작성자 | 변경사항 |
|------|------|--------|----------|
| v1.0 | 2025-09-07 | 개발팀 | 최초 작성, Supabase 설정 및 초기화 가이드 |

---

## 📋 사전 요구사항

- Node.js 20.x 이상
- pnpm 패키지 매니저 (`npm install -g pnpm`)
- Supabase 계정 (https://supabase.com)
- Vercel 계정 (선택사항, 배포시)

## 🚀 빠른 시작

### 1. 프로젝트 클론 및 의존성 설치

```bash
# 프로젝트 클론
git clone https://github.com/your-username/yuandi-erp.git
cd yuandi-erp

# 의존성 설치
pnpm install
```

### 2. Supabase 프로젝트 생성

1. [Supabase Dashboard](https://app.supabase.com) 접속
2. "New project" 클릭
3. 프로젝트 정보 입력:
   - Project name: `yuandi-erp`
   - Database Password: 안전한 비밀번호 설정
   - Region: Seoul (ap-northeast-2) 선택

### 3. 데이터베이스 초기화

#### 3.1 완전 초기화 (새로운 설치)

```sql
-- Supabase SQL Editor에서 실행
-- scripts/init-database.sql 내용 전체 실행

-- 1. 기존 테이블 삭제 (있는 경우)
DROP TABLE IF EXISTS cashbook_transactions CASCADE;
DROP TABLE IF EXISTS inventory_logs CASCADE;
DROP TABLE IF EXISTS shipments CASCADE;
DROP TABLE IF EXISTS order_items CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS event_logs CASCADE;
DROP TABLE IF EXISTS user_profiles CASCADE;

-- 2. 테이블 생성 (init-database.sql 참조)
-- 3. RLS 정책 설정
-- 4. 인덱스 생성
```

#### 3.2 초기 관리자 계정 생성

1. **Supabase Dashboard에서 사용자 생성**:
   - Authentication > Users > "Invite user" 클릭
   - Email: `admin@yuandi.com`
   - Password: `yuandi123!`
   - "Auto Confirm User" 체크
   - "Send invitation email" 체크 해제

2. **user_profiles 테이블에 프로필 추가**:
```sql
-- 생성된 User ID를 복사하여 사용
INSERT INTO user_profiles (id, email, name, role, active) 
VALUES (
  'auth.users에서 복사한 UUID',
  'admin@yuandi.com',
  '관리자',
  'ADMIN',
  true
);
```

또는 스크립트 사용:
```bash
node scripts/init-admin.sql
```

### 4. 환경 변수 설정

```bash
# .env.local 파일 생성
cp .env.example .env.local
```

`.env.local` 파일 편집:
```env
# Supabase 설정 (Dashboard > Settings > API에서 확인)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_API_KEY=your-anon-key
SUPABASE_API_KEY=your-service-role-key

# 앱 설정
APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_URL=http://localhost:3000

# 배포시 Vercel에서 자동 설정
NEXT_PUBLIC_VERCEL_URL=
```

### 5. Storage 버킷 생성

Supabase Dashboard > Storage:
1. "New bucket" 클릭
2. 버킷 생성:
   - Name: `product-images` (상품 이미지)
   - Public: Yes
   - Name: `shipment-photos` (송장 사진)
   - Public: Yes

### 6. Realtime 설정

Supabase Dashboard > Database > Replication:
1. 다음 테이블 활성화:
   - `orders` (주문 실시간 업데이트)
   - `inventory_logs` (재고 변동 실시간)
   - `cashbook_transactions` (출납장부 실시간)

### 7. 개발 서버 실행

```bash
# 개발 서버 시작
pnpm dev

# http://localhost:3000 접속
# 로그인: admin@yuandi.com / yuandi123!
```

## 🔧 추가 설정

### Edge Functions (선택사항)

```bash
# Supabase CLI 설치
npm install -g supabase

# Edge Functions 배포
supabase functions deploy
```

### Cron Jobs 설정 (선택사항)

Vercel에서 자동 작업 설정:
- 일일 리포트 생성
- 재고 알림
- 백업 작업

## ⚠️ 문제 해결

### 로그인 실패 (Invalid login credentials)

1. auth.users 테이블에 사용자 존재 확인
2. user_profiles 테이블에 동일한 ID로 프로필 존재 확인
3. 비밀번호 재설정: Dashboard > Authentication > Users > Reset password

### 포트 충돌

```bash
# 다른 포트 사용
PORT=3001 pnpm dev
```

### 데이터베이스 연결 실패

1. Supabase 프로젝트 상태 확인 (일시정지되지 않았는지)
2. 환경 변수 확인
3. 네트워크 연결 확인

## 📚 참고 문서

- [PRD.md](./docs/PRD.md) - 제품 요구사항 문서
- [DATABASE_ERD.md](./docs/DATABASE_ERD.md) - 데이터베이스 스키마
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - 배포 가이드
- [MAINTENANCE_GUIDE.md](./MAINTENANCE_GUIDE.md) - 유지보수 가이드