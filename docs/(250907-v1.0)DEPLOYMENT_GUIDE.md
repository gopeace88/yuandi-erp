# (250907-v1.0)DEPLOYMENT_GUIDE.md â€” ë°°í¬ ê°€ì´ë“œ

## ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ì‚¬í•­ |
|------|------|--------|----------|
| v1.0 | 2025-09-07 | ê°œë°œíŒ€ | ìµœì´ˆ ì‘ì„±, Vercel ë° Docker ë°°í¬ ê°€ì´ë“œ |

---

## ğŸš€ Vercel ë°°í¬ (ê¶Œì¥)

### 1. GitHub ì €ì¥ì†Œ ì¤€ë¹„

```bash
# Git ì´ˆê¸°í™” (ì´ë¯¸ ë˜ì–´ìˆìœ¼ë©´ ìƒëµ)
git init
git add .
git commit -m "Initial commit"

# GitHub ì €ì¥ì†Œ ì—°ê²°
git remote add origin https://github.com/your-username/yuandi-erp.git
git push -u origin main
```

### 2. Vercel í”„ë¡œì íŠ¸ ìƒì„±

1. [Vercel Dashboard](https://vercel.com/dashboard) ì ‘ì†
2. "New Project" í´ë¦­
3. GitHub ì €ì¥ì†Œ Import
4. í”„ë¡œì íŠ¸ ì„¤ì •:
   - Framework Preset: `Next.js`
   - Root Directory: `./` (ê¸°ë³¸ê°’)
   - Node.js Version: `20.x`

### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

Vercel Dashboard > Settings > Environment Variables:

```env
# Supabase (í•„ìˆ˜)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_API_KEY=your-anon-key
SUPABASE_API_KEY=your-service-role-key

# ì•± ì„¤ì •
NEXT_PUBLIC_APP_URL=https://your-domain.vercel.app
APP_URL=https://your-domain.vercel.app

# Cron Jobs (ì„ íƒì‚¬í•­)
CRON_SECRET=your-secret-key
```

### 4. ë¹Œë“œ ì„¤ì • ìµœì í™”

`vercel.json` íŒŒì¼:
```json
{
  "buildCommand": "pnpm build",
  "installCommand": "pnpm install --frozen-lockfile",
  "framework": "nextjs",
  "regions": ["icn1"],
  "functions": {
    "app/api/**/*.ts": {
      "maxDuration": 30
    }
  }
}
```

### 5. ë°°í¬

```bash
# Vercel CLI ì‚¬ìš©
npm i -g vercel
vercel

# ë˜ëŠ” Git Pushë¡œ ìë™ ë°°í¬
git push origin main
```

## ğŸ³ Docker ë°°í¬ (ëŒ€ì•ˆ)

### 1. Docker ì´ë¯¸ì§€ ë¹Œë“œ

`Dockerfile`:
```dockerfile
FROM node:20-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install pnpm
RUN npm install -g pnpm

# Install dependencies
COPY package.json pnpm-lock.yaml ./
RUN pnpm install --frozen-lockfile

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Build
RUN npm run build

# Production image
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000

CMD ["node", "server.js"]
```

### 2. Docker Compose ì„¤ì •

`docker-compose.yml`:
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_API_KEY=${NEXT_PUBLIC_SUPABASE_API_KEY}
      - SUPABASE_API_KEY=${SUPABASE_API_KEY}
    restart: unless-stopped
```

### 3. ë°°í¬ ì‹¤í–‰

```bash
# ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f
```

## ğŸ“± PWA ì„¤ì • (ì„ íƒì‚¬í•­)

### 1. next-pwa ì„¤ì¹˜

```bash
pnpm add next-pwa
```

### 2. next.config.js ìˆ˜ì •

```javascript
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development'
})

module.exports = withPWA({
  // ê¸°ì¡´ ì„¤ì •
})
```

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

### 1. í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ

- Service Role KeyëŠ” ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©
- NEXT_PUBLIC_ ì ‘ë‘ì‚¬ëŠ” í´ë¼ì´ì–¸íŠ¸ ë…¸ì¶œ ë³€ìˆ˜ë§Œ
- GitHub Secrets ì‚¬ìš©í•˜ì—¬ ë¯¼ê° ì •ë³´ ë³´í˜¸

### 2. CORS ì„¤ì •

Supabase Dashboard > Settings > API:
- Allowed Originsì— ë°°í¬ ë„ë©”ì¸ ì¶”ê°€
- `https://your-domain.vercel.app`

### 3. Rate Limiting

```typescript
// middleware.ts
import { Ratelimit } from '@upstash/ratelimit'
import { Redis } from '@upstash/redis'

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '10 s'),
})
```

## ğŸ”„ CI/CD ì„¤ì •

### GitHub Actions

`.github/workflows/deploy.yml`:
```yaml
name: Deploy to Vercel

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20
          
      - name: Install pnpm
        run: npm install -g pnpm
        
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
        
      - name: Run tests
        run: pnpm test
        
      - name: Build
        run: pnpm build
        
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
```

## ğŸ·ï¸ ë„ë©”ì¸ ì„¤ì •

### 1. ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì—°ê²°

Vercel Dashboard > Settings > Domains:
1. "Add Domain" í´ë¦­
2. ë„ë©”ì¸ ì…ë ¥: `yuandi.com`
3. DNS ì„¤ì • ì•ˆë‚´ ë”°ë¼ ì§„í–‰

### 2. SSL ì¸ì¦ì„œ

- Vercel: ìë™ìœ¼ë¡œ Let's Encrypt SSL ì œê³µ
- Docker: nginx-proxy + letsencrypt-companion ì‚¬ìš©

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### 1. Vercel Analytics

```bash
pnpm add @vercel/analytics
```

```tsx
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react'

export default function RootLayout() {
  return (
    <html>
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  )
}
```

### 2. Sentry Error Tracking

```bash
pnpm add @sentry/nextjs
```

```javascript
// sentry.client.config.js
Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.NODE_ENV,
})
```

## âš ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¹Œë“œ ì‹¤íŒ¨

1. Node.js ë²„ì „ í™•ì¸ (20.x ì´ìƒ)
2. pnpm-lock.yaml íŒŒì¼ ì¡´ì¬ í™•ì¸
3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸

### ë°°í¬ í›„ 500 ì—ëŸ¬

1. í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½ í™•ì¸
2. Supabase ì—°ê²° í™•ì¸
3. Vercel Functions ë¡œê·¸ í™•ì¸

### ì„±ëŠ¥ ì´ìŠˆ

1. Image Optimization í™œì„±í™”
2. Edge Runtime ì‚¬ìš© ê³ ë ¤
3. ISR (Incremental Static Regeneration) ì ìš©

## ğŸ“š ì°¸ê³  ë§í¬

- [Vercel Documentation](https://vercel.com/docs)
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [Supabase Production Checklist](https://supabase.com/docs/guides/platform/going-into-prod)