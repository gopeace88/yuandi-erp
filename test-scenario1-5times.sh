#!/bin/bash

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "     ì‹œë‚˜ë¦¬ì˜¤ 1 - 5íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ì‹œì‘ ì‹œê°„: $(date)"
echo ""

success=0
fail=0

for i in {1..5}; do
  echo "ì‹¤í–‰ $i/5: "
  echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

  # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  if npx playwright test tests/e2e/scenario-1-working.spec.ts --reporter=list --timeout=90000 2>&1 | tee /tmp/test-$i.log | grep -q "1 passed"; then
    echo "âœ… ì„±ê³µ"
    success=$((success + 1))
  else
    echo "âŒ ì‹¤íŒ¨"
    fail=$((fail + 1))
    # ì‹¤íŒ¨ ì›ì¸ í‘œì‹œ
    grep -E "Error:|timeout|failed" /tmp/test-$i.log | head -3
  fi

  echo ""
  sleep 3
done

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "í…ŒìŠ¤íŠ¸ ê²°ê³¼"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ì„±ê³µ: $success/5"
echo "ì‹¤íŒ¨: $fail/5"
echo "ì„±ê³µë¥ : $((success * 20))%"

if [ $success -eq 5 ]; then
  echo "ğŸŸ¢ ì™„ë²½í•œ ì„±ê³µ!"
elif [ $success -ge 4 ]; then
  echo "ğŸŸ¡ ëŒ€ì²´ë¡œ ì•ˆì •ì "
elif [ $success -ge 3 ]; then
  echo "ğŸŸ  ê°œì„  í•„ìš”"
else
  echo "ğŸ”´ ë¶ˆì•ˆì •"
fi

echo ""
echo "ì™„ë£Œ ì‹œê°„: $(date)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"